local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UnfavoriteEvent = Instance.new("RemoteEvent")
UnfavoriteEvent.Name = "UnfavoriteAll"
UnfavoriteEvent.Parent = ReplicatedStorage

UnfavoriteEvent.OnServerEvent:Connect(function(player)
	local InventoryManager = require(script.Parent.InventoryManager)
	InventoryManager.AutoUnfavoriteAll(player)
end)


-- ServerScriptService/InventoryManager.lua
local DataStoreService = game:GetService("DataStoreService")
local InventoryStore = DataStoreService:GetDataStore("PlayerInventory")

local InventoryManager = {}

function InventoryManager.LoadInventory(player)
	local key = "inventory_" .. player.UserId
	local data = InventoryStore:GetAsync(key)
	if not data then
		data = { items = {}, favorites = {} }
	end
	return data
end

function InventoryManager.SaveInventory(player, data)
	local key = "inventory_" .. player.UserId
	InventoryStore:SetAsync(key, data)
end

function InventoryManager.AutoUnfavoriteAll(player)
	local data = InventoryManager.LoadInventory(player)
	data.favorites = {} -- kosongkan semua favorit
	InventoryManager.SaveInventory(player, data)
	print("All items unfavorited for", player.Name)
end

game.Players.PlayerAdded:Connect(function(player)
	local inv = InventoryManager.LoadInventory(player)
	print("Inventory loaded for", player.Name)
end)

game.ReplicatedStorage.UnfavoriteAll.OnServerEvent:Connect(function(player)
	InventoryManager.AutoUnfavoriteAll(player)
end)

return InventoryManager
